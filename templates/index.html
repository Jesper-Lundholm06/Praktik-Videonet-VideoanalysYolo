<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Videoanalys - Live H.264</title>

    <!-- HLS.js - Bibliotek som spelar HLS i alla webbläsare -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        body {
            background-color: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #00d4ff;
            margin-bottom: 20px;
        }

        video {
            max-width: 90%;
            border: 3px solid #00d4ff;
            border-radius: 10px;
        }

        .info {
            margin-top: 15px;
            color: #888;
        }
    </style>
</head>
<body>
    <h1>Videoanalys - Live Kamera (H.264)</h1>

    <!-- Video-element istället för img -->
    <video id="video" autoplay muted playsinline></video>

    <p class="info">Kamera: Bosch IP | Detektion: YOLOv8 Nano | Kodning: H.264/HLS</p>

    <script>
        // Hämta video-elementet
        var video = document.getElementById('video');

        // Kolla om webbläsaren stöder HLS via hls.js
        if (Hls.isSupported()) {
            var hls = new Hls({
    liveSyncDurationCount: 0,
    liveMaxLatencyDurationCount: 1,
    lowLatencyMode: true
});


            // Ladda HLS-spellistan från Flask
            hls.loadSource('/hls/stream.m3u8');
            hls.attachMedia(video);

            // Spela upp automatiskt när data finns
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                video.play();
            });
        }
        // Safari stöder HLS direkt utan hls.js
        else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = '/hls/stream.m3u8';
        }
    </script>
</body>
</html>